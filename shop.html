<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Saleor Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jQuery + Owl Carousel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@7/dist/ionicons/ionicons.esm.js"></script>

  <link rel="stylesheet" href="style.css">
  <style>
    /* Custom Owl Carousel Dots Styling */
    .owl-dots {
      text-align: center;
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 5px;
    }

    .owl-dot span {
      width: 8px;
      height: 8px;
      margin: 0;
      background: #d1d5db !important;
      /* Gray-300 */
      display: block;
      border-radius: 50%;
      transition: background 0.3s;
    }

    .owl-dot.active span {
      background: #000000 !important;
      /* Black */
    }

    .owl-theme .owl-nav.disabled+.owl-dots {
      margin-top: 10px;
    }
  </style>

</head>

<body class="bg-black min-h-[130vh]">

  <!-- Header -->
  <header class="bg-gray-900 shadow-lg sticky top-0 z-50 ">
    <nav class="container mx-auto px-4 py-4 flex items-center justify-between" id="desktop-nav">
      <div class="text-2xl font-bold text-gold-500"><img src="logo.png" style="height: 8vh;" alt=""></div>

      <ul class="hidden md:flex space-x-6 text-gray-300">
        <li><a href="https://b-oneinterior.com/" class="hover:text-gold-500 transition">Home</a></li>
        <li><a href="https://b-oneinterior.com/shop" class="hover:text-gold-500 transition">Shop</a></li>
        <li><a href="https://b-oneinterior.com/company" class="hover:text-gold-500 transition">Services</a></li>
        <li><a href="https://b-oneinterior.com/gallery" class="hover:text-gold-500 transition">Gallery</a></li>
        <li><a href="https://b-oneinterior.com/cart" class="hover:text-gold-500 transition">Cart</a></li>
      </ul>
      <button class="md:hidden text-gold-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </nav>

    <div class="floating-icon">
      <a target="_blank" href="tel:+917738130131"><img style="max-width: initial;height: 4.5vh;"
          src="images/call_icon.svg" alt="Call" srcset=""></a>
      <a target="_blank" href="https://wa.me/+917738130131?text=Hi%20B-oneinterion%20Team"><img
          style="max-width: initial;height: 5.5vh;" src="images/whatsapp.svg" alt="WhatsApp" srcset=""></a>
      <a target="_blank" href="https://www.facebook.com/boneinterior"><img
          style="max-width: initial;height: 4.5vh; filter: invert(48%) sepia(79%) saturate(452%) hue-rotate(10deg) brightness(97%) contrast(87%);"
          src="images/facebook.svg" alt="Facebook" srcset=""></a>
      <a target="_blank" href="https://www.instagram.com/boneinterior"><img
          style="max-width: initial;height: 4.5vh; filter: invert(48%) sepia(79%) saturate(452%) hue-rotate(10deg) brightness(97%) contrast(87%);"
          src="images/instagram.svg" alt="Instagram" srcset=""></a>
      <a target="_blank" href="https://www.youtube.com/@boneinterior"><img
          style="max-width: initial;height: 4.5vh; filter: invert(48%) sepia(79%) saturate(452%) hue-rotate(10deg) brightness(97%) contrast(87%);"
          src="images/youtube.svg" alt="YouTube" srcset=""></a>
      <a target="_blank" href="https://maps.google.com/?q=B-One+Interior"><img
          style="max-width: initial;height: 4.5vh; filter: invert(48%) sepia(79%) saturate(452%) hue-rotate(10deg) brightness(97%) contrast(87%);"
          src="images/map_marker.svg" alt="Location" srcset=""></a>
    </div>

    <div id="drawer">
      <ul>
        <li><a href="#company">Company</a></li>
        <li><a href="#shop">Shop</a></li>
        <li><a href="#services">Services</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <!-- <li><a href="#gallery">Locations</a></li>
        <li><a href="#gallery">Blogs</a></li> -->
        <li><a href="#contact">Contact Us</a></li>
      </ul>
    </div>
    <label for="menu-toggle" class="overlay"></label>

    <div class="fixedBottom">
      <a href="https://b-oneinterior.com/" class="logoBx"></a>
      <ul>
        <li>
          <a href="https://b-oneinterior.com/gallery">
            <ion-icon name="images-outline"></ion-icon>
            <div>Gallery</div>
          </a>
        </li>


        <li>
          <a href="https://b-oneinterior.com/shop">
            <ion-icon name="storefront-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
            <div>Shop</div>

          </a>
        </li>
        <li></li>

        <li>
          <a href="https://b-oneinterior.com/company">
            <ion-icon name="people-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
            <div>Company</div>
          </a>
        </li>


        <li>
          <a href="https://b-oneinterior.com/cart">
            <ion-icon name="cart-outline"></ion-icon>
            <div>Cart</div>
            <span id="cartCountBadge" class="absolute -top-2 -right-3 bg-gold text-black text-xs font-bold 
                                w-5 h-5 flex items-center justify-center rounded-full hidden">
            </span>

          </a>
        </li>
        <!-- <li>
                <a href="#" id="menu-toggle" onclick="toggleMenu(this)">
                    <div>
                        <div class="menu-icon" id="menu-btn">&#9776;</div>
                        
                    </div>

                </a>

            </li> -->
      </ul>
    </div>

    <script>
      //   const drawer = document.getElementById("drawer");
      //   const overlay = document.querySelector(".overlay");
      //   const menuBtn = document.getElementById("menu-btn");

      //   menuBtn.addEventListener("click", () => {
      //       drawer.style.left = drawer.style.left === "0px" ? "-250px" : "0px";
      //       toggleOverlay();
      //   });

      //   overlay.addEventListener("click", () => {
      //       drawer.style.left = "-250px";
      //       hideOverlay();
      //   });

      //   function toggleOverlay() {
      //       if (overlay.style.opacity === "1") {
      //           hideOverlay();
      //       } else {
      //           showOverlay();
      //       }
      //   }

      //   function showOverlay() {
      //       overlay.style.opacity = "1";
      //       overlay.style.pointerEvents = "auto";
      //   }

      //   function hideOverlay() {
      //       overlay.style.opacity = "0";
      //       overlay.style.pointerEvents = "none";
      //   }
    </script>
  </header>

  <div class="container mx-auto px-4 py-10 space-y-6">

    <aside class="bg-gray-100 p-6 shadow rounded-lg space-y-6 sticky top-0 z-40">
      <div>
        <h3 class="font-semibold mb-3">Categories</h3>
        <div id="categoryFilter" class="flex flex-wrap gap-2"></div>
        <br>
        <hr>
        <div id="subcategoryFilter" class="flex flex-wrap gap-2 mt-3 hidden">

        </div>
      </div>
    </aside>

    <!-- Mobile: Vertical scroll product list -->
    <div id="mobileProductList" class="block md:hidden space-y-4"></div>

    <!-- Desktop: Grid layout -->
    <main id="productGrid" class="hidden md:grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6"></main>

  </div>

  <script>
    const API_URL = "https://api.b-oneinterior.com/graphql/";
    const HIDDEN_CATEGORY_NAME = "Gallery Image Category";
    const FALLBACK_IMG = "https://via.placeholder.com/300x300?text=No+Image";

    // Updated query to fetch parent category information and product attributes
    const QUERY = `
query {
  categories(first: 100) { 
    edges { 
      node { 
        id 
        name 
        parent { 
          id 
          name 
        } 
      } 
    } 
  }
  products(first: 100, channel: "in") { 
    edges { 
      node { 
        id 
        name 
        slug 
        description
        media {
          url
          type
        }
        attributes {
          attribute {
            name
          }
          values {
            name
            file {
              url
            }
          }
        }
        pricing {
            priceRange {
              start {
                gross {
                  amount
                  currency
                }
              }
            }
        }
        category { 
          id 
          name 
          parent { 
            id 
            name 
          } 
        } 
        productType { 
          id 
          name 
        } 
        thumbnail { 
          url 
        } 
      } 
    } 
  }
}
`;

    let allCategories = [];
    let allProducts = [];
    let selectedParentCategory = null;

    async function fetchSaleor() {
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: QUERY })
        });
        const json = await res.json();
        if (json.errors) console.error("GraphQL errors:", json.errors);
        return json.data;
      } catch (err) {
        console.error("Fetch error:", err);
        return null;
      }
    }

    function getParentCategories(categories) {
      return categories.filter(c => !c.parent && c.name !== HIDDEN_CATEGORY_NAME);
    }

    function getSubcategories(categories, parentId) {
      return categories.filter(c => c.parent?.id === parentId);
    }

    function getCategoryCounts(products, categoryId) {
      return products.filter(p => {
        // Count products that belong to this category or have this category as parent
        return p.category?.id === categoryId || p.category?.parent?.id === categoryId;
      }).length;
    }

    function renderCategoryFilters(categories, products) {
      const parentCategories = getParentCategories(categories);

      // Calculate counts for parent categories (including their subcategories' products)
      const parentCounts = {};
      parentCategories.forEach(parent => {
        const subcats = getSubcategories(categories, parent.id);
        const subcatIds = subcats.map(s => s.id);
        parentCounts[parent.id] = products.filter(p =>
          p.category?.id === parent.id || subcatIds.includes(p.category?.id)
        ).length;
      });

      document.getElementById("categoryFilter").innerHTML = `
    <button class="filter-category px-3 py-1 rounded-full border text-sm bg-gold text-white" data-category="all" data-is-parent="true">
      All (${products.length})
    </button>
    ${parentCategories.map(c => `
      <button class="filter-category px-3 py-1 rounded-full border border-gray-300 text-gray-700 text-sm" data-category="${c.id}" data-is-parent="true">
        ${c.name} (${parentCounts[c.id] || 0})
      </button>`).join("")}
  `;

      // Hide subcategory filter initially
      document.getElementById("subcategoryFilter").classList.add("hidden");
      document.getElementById("subcategoryFilter").innerHTML = "";
    }

    function renderSubcategoryFilters(parentId) {
      const subcategories = getSubcategories(allCategories, parentId);
      const subcategoryContainer = document.getElementById("subcategoryFilter");

      if (subcategories.length === 0) {
        subcategoryContainer.classList.add("hidden");
        subcategoryContainer.innerHTML = "";
        return;
      }

      // Calculate counts for subcategories
      const subcatCounts = {};
      subcategories.forEach(sub => {
        subcatCounts[sub.id] = allProducts.filter(p => p.category?.id === sub.id).length;
      });

      // Get parent products count (products directly in parent, not in subcategories)
      const parentDirectCount = allProducts.filter(p => p.category?.id === parentId).length;
      const allInParentCount = allProducts.filter(p =>
        p.category?.id === parentId || subcategories.map(s => s.id).includes(p.category?.id)
      ).length;

      subcategoryContainer.innerHTML = `
    <button class="filter-subcategory px-3 py-1 rounded-full border text-sm bg-gold text-white" data-subcategory="all">
      All (${allInParentCount})
    </button>
    ${subcategories.map(s => `
      <button class="filter-subcategory px-3 py-1 rounded-full border border-gray-300 text-gray-700 text-sm" data-subcategory="${s.id}">
        ${s.name} (${subcatCounts[s.id] || 0})
      </button>`).join("")}
  `;

      subcategoryContainer.classList.remove("hidden");
    }

    function getActualPrice(product) {
      if (!product.attributes) return null;
      const priceAttr = product.attributes.find(a => a.attribute.name === "Actual Price");
      if (priceAttr && priceAttr.values && priceAttr.values.length > 0) {
        return priceAttr.values[0].name;
      }
      return null;
    }

    function getCatalogueLink(product) {
      if (!product.attributes) return null;
      const catAttr = product.attributes.find(a => a.attribute.name === "Catalogue");
      if (catAttr && catAttr.values && catAttr.values.length > 0) {
        return catAttr.values[0].file?.url;
      }
      return null;
    }

    function renderGrid(products) {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = products.length ? products.map(p => {
        const actualPriceStr = getActualPrice(p);
        const currentPriceObj = p.pricing?.priceRange?.start?.gross;
        const currentPriceVal = currentPriceObj ? currentPriceObj.amount : null;
        const currency = currentPriceObj ? currentPriceObj.currency : "";
        const catalogueUrl = getCatalogueLink(p);

        let priceHtml = "";
        let badgeHtml = "";
        let catalogueBadgeHtml = "";

        // Catalogue Link (Overlay)
        if (catalogueUrl) {
          catalogueBadgeHtml = `<a href="${catalogueUrl}" target="_blank" class="absolute bottom-2 right-2 bg-white/90 text-gold text-xs font-bold px-2 py-1 rounded shadow-sm z-10 hover:bg-gold hover:text-white transition cursor-pointer">View Catalogue</a>`;
        }

        // Calculate Discount
        if (actualPriceStr && currentPriceVal) {
          const actualVal = parseFloat(actualPriceStr.replace(/[^0-9.]/g, ''));
          if (!isNaN(actualVal) && actualVal > currentPriceVal) {
            const discount = ((actualVal - currentPriceVal) / actualVal) * 100;
            if (discount > 0) {
              badgeHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${Math.round(discount)}% OFF</div>`;
            }
          }
        }

        // Build Price HTML (Compact for footer)
        if (actualPriceStr || currentPriceVal) {
          priceHtml = `<div class="flex-1 flex items-baseline justify-end gap-2 leading-tight min-w-0">`;
          if (actualPriceStr) {
            priceHtml += `<span class="line-through text-gray-400 text-xs">${actualPriceStr}</span>`;
          }
          if (currentPriceVal) {
            const formattedPrice = currency === 'INR' ? `₹${currentPriceVal.toFixed(2)}` : `${currentPriceVal.toFixed(2)} ${currency}`;
            priceHtml += `<span class="text-green-600 font-bold text-lg">${formattedPrice}</span>`;
          }
          priceHtml += `</div>`;
        }

        // Description Logic
        let descHtml = "";
        if (p.description) {
          // Attempt to parse if it's JSON string, or just use if string.
          // Saleor often returns JSON for description. 
          // Simple check: if it looks like JSON objects blocks...
          // For now, let's treat it as string or try to extract text if it's an object.
          let descText = p.description;
          if (typeof p.description === 'string' && p.description.startsWith('{')) {
            try {
              const descObj = JSON.parse(p.description);
              // Very basic extraction if it's EditorJS/DraftJS
              if (descObj.blocks) {
                descText = descObj.blocks.map(b => b.data.text).join(' ');
              }
            } catch (e) { }
          }
          if (descText.length > 100) {
            descText = descText.substring(0, 100) + "...";
          }
          descHtml = `<p class="text-xs text-gray-600 mt-2 line-clamp-2">${descText}</p>`;
        }

        // Image Carousel Logic
        let imageHtml = "";
        if (p.media && p.media.length > 0) {
          imageHtml = `<div class="owl-carousel product-carousel">`;
          p.media.forEach(m => {
            if (m.type === 'IMAGE') {
              imageHtml += `<img src="${m.url}" class="w-full h-40 object-cover" alt="${p.name}">`;
            }
          });
          imageHtml += `</div>`;
        } else {
          imageHtml = `<img src="${p.thumbnail?.url || FALLBACK_IMG}" class="w-full h-48 object-cover" alt="${p.name}">`;
        }

        return `
    <div class="product-card bg-white shadow rounded-lg hover:shadow-lg transition flex flex-col relative group overflow-hidden" data-category="${p.category?.id || ''}" data-type="${p.productType?.id || ''}">
      <div class="relative">
          ${badgeHtml}
          <!-- Product Type Badge (Top Right) -->
          ${p.productType?.name ? `<div class="absolute top-2 right-2 bg-white/90 text-gray-700 text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${p.productType.name}</div>` : ''}
          ${imageHtml}
          <!-- Category Badge (Bottom Left) -->
          ${p.category?.name ? `<div class="absolute bottom-2 left-2 bg-white/90 text-gray-700 text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${p.category.name}</div>` : ''}
          ${catalogueBadgeHtml}
      </div>
      
      <div class="p-4 flex flex-col flex-grow">
          <p class="font-semibold truncate">${p.name}</p>
          ${descHtml}
          
          <div class="flex items-center justify-between gap-2 mt-auto border-t pt-3">
               <button class="inquiry-btn flex-1 py-2 rounded-full text-xs font-medium bg-gold text-white hover:opacity-90 min-w-0"
                    data-id="${p.id}"
                    data-name="${p.name}"
                    data-category="${p.category?.name || ''}"
                    data-type="${p.productType?.name || ''}"
                    data-image="${p.thumbnail?.url || FALLBACK_IMG}">
                Add to inquiry
              </button>
              ${priceHtml}
          </div>
      </div>
    </div>
  `}).join("") : `<p class="col-span-full text-center text-gray-500">No products found.</p>`;

      // Initialize Carousel
      setTimeout(() => {
        $('.product-carousel').owlCarousel({
          items: 1,
          loop: true,
          dots: true,
          nav: false,
          margin: 10
        });
      }, 100);
    }

    function renderMobileList(products) {
      const mobileList = document.getElementById("mobileProductList");
      mobileList.innerHTML = products.length ? products.map(p => {
        const actualPriceStr = getActualPrice(p);
        const currentPriceObj = p.pricing?.priceRange?.start?.gross;
        const currentPriceVal = currentPriceObj ? currentPriceObj.amount : null;
        const currency = currentPriceObj ? currentPriceObj.currency : "";
        const catalogueUrl = getCatalogueLink(p);

        let priceHtml = "";
        let badgeHtml = "";
        let catalogueBadgeHtml = "";

        if (catalogueUrl) {
          catalogueBadgeHtml = `<a href="${catalogueUrl}" target="_blank" class="absolute bottom-2 right-2 bg-white/90 text-gold text-xs font-bold px-2 py-1 rounded shadow-sm z-10 hover:bg-gold hover:text-white transition cursor-pointer">View Catalogue</a>`;
        }

        // Calculate Discount
        if (actualPriceStr && currentPriceVal) {
          const actualVal = parseFloat(actualPriceStr.replace(/[^0-9.]/g, ''));
          if (!isNaN(actualVal) && actualVal > currentPriceVal) {
            const discount = ((actualVal - currentPriceVal) / actualVal) * 100;
            if (discount > 0) {
              badgeHtml = `<div class="absolute top-2 left-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${Math.round(discount)}% OFF</div>`;
            }
          }
        }

        // Build Price HTML
        if (actualPriceStr || currentPriceVal) {
          priceHtml = `<div class="flex-1 flex items-baseline justify-end gap-2 leading-tight min-w-0">`;
          if (actualPriceStr) {
            priceHtml += `<span class="line-through text-gray-400 text-xs">${actualPriceStr}</span>`;
          }
          if (currentPriceVal) {
            const formattedPrice = currency === 'INR' ? `₹${currentPriceVal.toFixed(2)}` : `${currentPriceVal.toFixed(2)} ${currency}`;
            priceHtml += `<span class="text-green-600 font-bold text-lg">${formattedPrice}</span>`;
          }
          priceHtml += `</div>`;
        }

        // Description Logic
        let descHtml = "";
        if (p.description) {
          let descText = p.description;
          // Simple basic cleaning if it's stringified JSON structure
          if (typeof p.description === 'string' && p.description.startsWith('{')) {
            try {
              const descObj = JSON.parse(p.description);
              if (descObj.blocks) {
                descText = descObj.blocks.map(b => b.data.text).join(' ');
              }
            } catch (e) { }
          }
          if (descText.length > 100) {
            descText = descText.substring(0, 100) + "...";
          }
          descHtml = `<p class="text-xs text-gray-600 mt-2 mb-2 line-clamp-3">${descText}</p>`;
        }

        // Image Carousel Logic
        let imageHtml = "";
        if (p.media && p.media.length > 0) {
          imageHtml = `<div class="owl-carousel product-carousel">`;
          p.media.forEach(m => {
            if (m.type === 'IMAGE') {
              imageHtml += `<img src="${m.url}" class="w-full h-48 object-cover" alt="${p.name}">`;
            }
          });
          imageHtml += `</div>`;
        } else {
          imageHtml = `<img src="${p.thumbnail?.url || FALLBACK_IMG}" class="w-full h-48 object-cover" alt="${p.name}">`;
        }

        return `
    <div class="bg-white shadow rounded-lg relative group overflow-hidden">
      <div class="relative">
          ${badgeHtml}
          <!-- Product Type Badge (Top Right) -->
          ${p.productType?.name ? `<div class="absolute top-2 right-2 bg-white/90 text-gray-700 text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${p.productType.name}</div>` : ''}
          ${imageHtml}
          <!-- Category Badge (Bottom Left) -->
          ${p.category?.name ? `<div class="absolute bottom-2 left-2 bg-white/90 text-gray-700 text-xs font-bold px-2 py-1 rounded shadow-sm z-10">${p.category.name}</div>` : ''}
          ${catalogueBadgeHtml}
      </div>
      
      <div class="p-4">
          <p class="font-semibold text-lg">${p.name}</p>
          ${descHtml}
          
          <div class="flex items-center justify-between gap-2 mt-2 border-t pt-3">
               <button class="inquiry-btn flex-1 py-2 rounded-full text-xs font-medium bg-gold text-white hover:opacity-90 min-w-0"
                    data-id="${p.id}"
                    data-name="${p.name}"
                    data-category="${p.category?.name || ''}"
                    data-type="${p.productType?.name || ''}"
                    data-image="${p.thumbnail?.url || FALLBACK_IMG}">
                Add to inquiry
              </button>
              ${priceHtml}
          </div>
      </div>
    </div>
  `}).join("") : `<p class="text-center text-gray-500">No products found.</p>`;

      // Initialize Carousel
      setTimeout(() => {
        $('.product-carousel').owlCarousel({
          items: 1,
          loop: true,
          dots: true,
          nav: false,
          margin: 10
        });
      }, 100);
    }

    function applyFilters() {
      const activeSubcat = document.querySelector(".filter-subcategory.bg-gold")?.dataset.subcategory;
      let filtered = allProducts;

      if (selectedParentCategory && selectedParentCategory !== "all") {
        const subcategories = getSubcategories(allCategories, selectedParentCategory);
        const subcatIds = subcategories.map(s => s.id);

        if (activeSubcat && activeSubcat !== "all") {
          // Filter by specific subcategory
          filtered = filtered.filter(p => p.category?.id === activeSubcat);
        } else {
          // Filter by parent category or any of its subcategories
          filtered = filtered.filter(p =>
            p.category?.id === selectedParentCategory || subcatIds.includes(p.category?.id)
          );
        }
      }

      renderGrid(filtered);
      renderMobileList(filtered);
      setupInquiryButtons();
    }

    function setupFiltering() {
      document.addEventListener("click", e => {
        // Handle parent category clicks
        if (e.target.classList.contains("filter-category")) {
          document.querySelectorAll(".filter-category").forEach(b => b.classList.remove("bg-gold", "text-white"));
          e.target.classList.add("bg-gold", "text-white");

          selectedParentCategory = e.target.dataset.category;

          if (selectedParentCategory === "all") {
            document.getElementById("subcategoryFilter").classList.add("hidden");
            document.getElementById("subcategoryFilter").innerHTML = "";
          } else {
            renderSubcategoryFilters(selectedParentCategory);
          }

          applyFilters();
        }

        // Handle subcategory clicks
        if (e.target.classList.contains("filter-subcategory")) {
          document.querySelectorAll(".filter-subcategory").forEach(b => b.classList.remove("bg-gold", "text-white"));
          e.target.classList.add("bg-gold", "text-white");
          applyFilters();
        }
      });
    }

    function setupInquiryButtons() {
      const buttons = document.querySelectorAll(".inquiry-btn");

      buttons.forEach(btn => {
        const id = btn.dataset.id;

        // Load state from localStorage
        const list = JSON.parse(localStorage.getItem("inquiryList") || "[]");
        const exists = list.some(item => item.id === id);

        if (exists) {
          btn.textContent = "Remove from inquiry list";
          btn.classList.remove("bg-gold");
          btn.classList.add("bg-gray-400");
        }

        btn.onclick = () => {
          let inquiryList = JSON.parse(localStorage.getItem("inquiryList") || "[]");

          const product = {
            id: btn.dataset.id,
            name: btn.dataset.name,
            category: btn.dataset.category,
            type: btn.dataset.type,
            image: btn.dataset.image
          };

          const already = inquiryList.some(i => i.id === product.id);

          if (already) {
            inquiryList = inquiryList.filter(i => i.id !== product.id);
            btn.textContent = "Add to inquiry list";
            btn.classList.add("bg-gold");
            btn.classList.remove("bg-gray-400");
          } else {
            inquiryList.push(product);
            btn.textContent = "Remove from inquiry list";
            btn.classList.remove("bg-gold");
            btn.classList.add("bg-gray-400");
          }

          localStorage.setItem("inquiryList", JSON.stringify(inquiryList));
          updateCartBadge();
        };
      });
    }

    function updateCartBadge() {
      const badge = document.getElementById("cartCountBadge");
      const list = JSON.parse(localStorage.getItem("inquiryList") || "[]");
      const count = list.length;

      if (count > 0) {
        badge.textContent = count;
        badge.classList.remove("hidden");
      } else {
        badge.classList.add("hidden");
      }
    }

    (async () => {
      const data = await fetchSaleor();
      if (!data) return alert("Error fetching Saleor API");

      allCategories = data.categories?.edges?.map(e => e.node) || [];
      let products = data.products?.edges?.map(e => e.node) || [];
      allProducts = products.filter(p => p.category?.name !== HIDDEN_CATEGORY_NAME);

      renderCategoryFilters(allCategories, allProducts);
      renderGrid(allProducts);
      renderMobileList(allProducts);
      setupFiltering();
      setupInquiryButtons();
      updateCartBadge();
    })();
  </script>

</body>

</html>