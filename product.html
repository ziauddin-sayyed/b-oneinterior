<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Product Details - B-One Interior Premium Collection</title>
    <meta property="og:title" content="Product Details - B-One Interior Premium Collection">
    <meta property="og:description"
        content="View detailed product specifications, pricing, and high-quality images. Add to your cart and bring home elegance with B-One Interior's premium furniture selection.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://b-oneinterior.com/logo.png">
    <meta name="twitter:image" content="https://b-oneinterior.com/logo.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- jQuery + Owl Carousel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7/dist/ionicons/ionicons.esm.js"></script>

    <link rel="stylesheet" href="style.css">

</head>

<body class="bg-white min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-black shadow-lg sticky top-0 z-50 border-b border-gold-700 pt-1">
        <nav class="container mx-auto px-4 py-4 flex items-center justify-between" id="desktop-nav">
            <div class="text-2xl font-bold text-gold-500"><img src="logo.png" style="height: 8vh;" alt=""></div>

            <ul class="hidden md:flex space-x-6 text-gray-300">
                <li><a href="https://b-oneinterior.com/" class="hover:text-gold-500 transition">Home</a></li>
                <li><a href="https://b-oneinterior.com/shop" class="hover:text-gold-500 transition">Shop</a></li>
                <li><a href="https://b-oneinterior.com/company" class="hover:text-gold-500 transition">Services</a></li>
                <li><a href="https://b-oneinterior.com/gallery" class="hover:text-gold-500 transition">Gallery</a></li>
                <li><a href="https://b-oneinterior.com/cart" class="hover:text-gold-500 transition">Cart</a></li>
            </ul>
            <button class="md:hidden text-gold-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
        </nav>

        <div class="floating-icon">
            <a target="_blank" href="tel:+917738130131"><img style="max-width: initial;height: 4.5vh;"
                    src="images/call_icon.png" alt="Call" srcset=""></a>
            <a target="_blank" href="https://wa.me/+917738130131?text=Hi%20B-oneinterion%20Team"><img
                    style="max-width: initial;height: 5.5vh;" src="images/whatsapp.png" alt="WhatsApp" srcset=""></a>
            <a target="_blank" href="https://www.facebook.com/share/1C4T1wQGLY/"><img
                    style="max-width: initial;height: 4.5vh;" src="images/facebook.png" alt="Facebook" srcset=""></a>
            <a target="_blank" href="https://www.instagram.com/bone.interior.solution?igsh=MWhwanB2OWEweXhlag=="><img
                    style="max-width: initial;height: 4.5vh;" src="images/instagram.png" alt="Instagram" srcset=""></a>
            <a target="_blank" href="https://youtube.com/@believeone307?si=T7B9HvbORx00jtFK"><img
                    style="max-width: initial;height: 4.5vh;" src="images/youtube.png" alt="YouTube" srcset=""></a>
            <a target="_blank" href="https://maps.app.goo.gl/pzqRhTqqncJHLWfEA"><img
                    style="max-width: initial;height: 4.5vh;" src="images/map_marker.png" alt="Location" srcset=""></a>
        </div>

        <div id="drawer">
            <ul>
                <li><a href="#company">Company</a></li>
                <li><a href="#shop">Shop</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#contact">Contact Us</a></li>
            </ul>
        </div>
        <label for="menu-toggle" class="overlay"></label>

        <div class="fixedBottom">
            <a href="https://b-oneinterior.com/" class="logoBx"></a>
            <ul>
                <li>
                    <a href="https://b-oneinterior.com/gallery">
                        <ion-icon name="images-outline"></ion-icon>
                        <div>Gallery</div>
                    </a>
                </li>


                <li>
                    <a href="https://b-oneinterior.com/shop">
                        <ion-icon name="storefront-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
                        <div>Shop</div>

                    </a>
                </li>
                <li></li>

                <li>
                    <a href="https://b-oneinterior.com/company">
                        <ion-icon name="people-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
                        <div>Company</div>
                    </a>
                </li>


                <li>
                    <a href="https://b-oneinterior.com/cart">
                        <ion-icon name="cart-outline"></ion-icon>
                        <div>Cart</div>
                        <span id="cartCountBadge" class="absolute -top-2 -right-3 bg-gold text-black text-xs font-bold 
                                w-5 h-5 flex items-center justify-center rounded-full hidden">
                        </span>

                    </a>
                </li>
            </ul>
        </div>

    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="fixed inset-0 bg-white/80 z-50 flex items-center justify-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-gold"></div>
        </div>

        <div id="productDetail" class="hidden grid grid-cols-1 md:grid-cols-2 gap-12">

            <!-- Left: Image Section -->
            <div class="w-full">
                <div id="imageContainer" class="rounded-lg overflow-hidden shadow-lg bg-gray-100">
                    <!-- Carousel will be injected here -->
                </div>
                <div id="variantContainer" class="mt-4 grid grid-cols-3 sm:grid-cols-4 gap-4">
                    <!-- Variants will be injected here -->
                </div>
            </div>

            <!-- Right: Details Section -->
            <div class="flex flex-col space-y-6">

                <!-- Title & Price -->
                <div>
                    <div id="metaContainer" class="flex flex-wrap gap-2 mb-3"></div>
                    <h1 id="productName" class="text-3xl md:text-4xl font-bold text-gray-900 mb-2"></h1>
                    <div id="priceContainer" class="flex items-baseline gap-4 mt-2"></div>
                </div>

                <!-- Catalogue Button -->
                <div id="catalogueContainer"></div>

                <!-- Short Description / Attributes -->
                <div id="descriptionContainer" class="text-gray-600 leading-relaxed text-sm md:text-base"></div>

                <!-- Attributes List -->
                <div id="attributesContainer" class="space-y-2 pt-4 border-t"></div>

                <!-- Add to Cart / Quantity -->
                <div class="pt-6 mt-auto">
                    <div id="cartActionContainer" class="w-full"></div>
                </div>

            </div>
        </div>

        <!-- Recommended Products Section -->
        <div class="mt-12 border-t pt-8">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Recommended For You</h2>
            <div id="recommendedCarousel" class="owl-carousel owl-theme"></div>
        </div>

        <div id="errorContainer" class="hidden text-center py-20">
            <h2 class="text-2xl font-bold text-gray-700">Product not found</h2>
            <a href="shop.html" class="text-gold hover:underline mt-4 inline-block">Return to Shop</a>
        </div>

    </main>

    <!-- Bottom Nav (Mobile) -->



    <script>
        const API_URL = "https://api.b-oneinterior.com/graphql/";
        const FALLBACK_IMG = "https://via.placeholder.com/600x600?text=No+Image";

        // Get Product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');

        async function fetchProductDetails(id) {
            const query = `
            query {
                product(id: "${id}", channel: "in") {
                    id
                    name
                    description
                    media {
                        url
                        type
                    }
                    thumbnail {
                        url
                    }
                    pricing {
                        priceRange {
                            start {
                                gross {
                                    amount
                                    currency
                                }
                            }
                        }
                    }
                    attributes {
                        attribute {
                            name
                        }
                        values {
                            name
                            file {
                                url
                            }
                        }
                    }
                    category {
                        name
                    }
                    productType {
                        name
                    }
                    variants {
                        id
                        name
                        media {
                            url
                            type
                        }
                        pricing {
                            price {
                                gross {
                                    amount
                                    currency
                                }
                            }
                        }
                    }
                }
            }
            `;

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query })
                });
                const json = await res.json();
                return json.data?.product;
            } catch (err) {
                console.error(err);
                return null;
            }

        }

        async function fetchRecommendedProducts(categoryName, currentId) {
            const query = `
            query {
                products(first: 100, channel: "in") {
                    edges {
                        node {
                            id
                            name
                            thumbnail { url }
                            pricing {
                                priceRange {
                                    start {
                                        gross {
                                            amount
                                            currency
                                        }
                                    }
                                }
                            }
                            category { name }
                        }
                    }
                }
            }
            `;

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query })
                });
                const json = await res.json();
                let products = json.data?.products?.edges || [];

                // Filter by Category & Exclude Current
                products = products.filter(p =>
                    p.node.category?.name === categoryName &&
                    p.node.id !== currentId
                ).slice(0, 10);

                const carousel = document.getElementById("recommendedCarousel");
                carousel.innerHTML = "";

                if (products.length === 0) {
                    carousel.innerHTML = '<p class="text-gray-500">No recommendations found.</p>';
                    return;
                }

                products.forEach(p => {
                    const price = p.node.pricing?.priceRange?.start?.gross?.amount?.toFixed(2) || "0.00";
                    const currency = p.node.pricing?.priceRange?.start?.gross?.currency === 'INR' ? '₹' : (p.node.pricing?.priceRange?.start?.gross?.currency || '');
                    const formattedPrice = p.node.pricing?.priceRange?.start?.gross?.currency === 'INR' ? `₹${price}` : `${price} ${currency}`;

                    const item = document.createElement("div");
                    item.className = "item px-1";
                    item.innerHTML = `
                        <a href="product.html?id=${p.node.id}" class="block bg-white shadow rounded-lg hover:shadow-lg transition flex flex-col relative group overflow-hidden cursor-pointer h-full border border-gray-100">
                            <div class="relative">
                                <img src="${p.node.thumbnail?.url || FALLBACK_IMG}" class="w-full h-40 object-cover" alt="${p.node.name}">
                            </div>
                            <div class="p-3 flex flex-col flex-grow">
                                <h3 class="font-semibold text-gray-800 text-sm truncate leading-tight mb-2">${p.node.name}</h3>
                                <div class="mt-auto border-t pt-2 w-full">
                                    <span class="text-gold font-bold text-base block">${formattedPrice}</span>
                                </div>
                            </div>
                        </a>
                    `;
                    carousel.appendChild(item);
                });

                // Init Owl Carousel
                setTimeout(() => {
                    $('#recommendedCarousel').owlCarousel({
                        loop: products.length > 4, // Only loop if enough items
                        margin: 10,
                        nav: false,
                        dots: true,
                        autoplay: true,
                        responsive: {
                            0: { items: 2 },
                            600: { items: 3 },
                            1000: { items: 4 }
                        }
                    });
                }, 100);

            } catch (e) {
                console.error("Error drawing recommended:", e);
            }
        }


        function getCart() {
            return JSON.parse(localStorage.getItem("inquiryList") || "[]");
        }

        function saveCart(cart) {
            localStorage.setItem("inquiryList", JSON.stringify(cart));
            updateCartBadge();
            renderCartAction(); // Re-render buttons
        }

        let currentProduct = null;

        async function init() {
            if (!productId) {
                showError();
                return;
            }

            currentProduct = await fetchProductDetails(productId);

            if (!currentProduct) {
                showError();
                return;
            }

            renderProduct(currentProduct);

            // Fetch Recommended
            if (currentProduct.category?.name) {
                fetchRecommendedProducts(currentProduct.category.name, currentProduct.id);
            }

            document.getElementById("loadingSpinner").classList.add("hidden");
            document.getElementById("productDetail").classList.remove("hidden");
        }

        function showError() {
            document.getElementById("loadingSpinner").classList.add("hidden");
            document.getElementById("errorContainer").classList.remove("hidden");
        }

        function getCategoryIcon(name) {
            const lowerName = name.toLowerCase();
            if (lowerName.includes('wallpaper')) return 'image-outline';
            if (lowerName.includes('plumbing')) return 'water-outline';
            if (lowerName.includes('fitting')) return 'build-outline';
            if (lowerName.includes('electric')) return 'flash-outline';
            if (lowerName.includes('carpentry')) return 'hammer-outline';
            return 'cube-outline';
        }

        function renderProduct(p) {
            // Meta Badges (Category & Type)
            const catName = p.category?.name || "Uncategorized";
            const typeName = p.productType?.name || "Standard";

            document.getElementById("metaContainer").innerHTML = `
                <span class="inline-flex items-center gap-1 bg-gold/10 text-gold text-xs font-bold px-3 py-1 rounded-full border border-gold/20">
                    <ion-icon name="${getCategoryIcon(catName)}"></ion-icon> ${catName}
                </span>
                <span class="inline-flex items-center gap-1 bg-gray-100 text-gray-600 text-xs font-bold px-3 py-1 rounded-full border border-gray-200">
                    <ion-icon name="pricetag-outline"></ion-icon> ${typeName}
                </span>
            `;

            // Name
            document.getElementById("productName").textContent = p.name;

            // Price
            const currentPriceObj = p.pricing?.priceRange?.start?.gross;
            const price = currentPriceObj ? currentPriceObj.amount : null;
            const currency = currentPriceObj ? currentPriceObj.currency : 'INR';

            // Extract "Actual Price" for discount logic
            const actualPriceAttr = p.attributes.find(a => a.attribute.name === "Actual Price");
            const actualPriceStr = actualPriceAttr?.values[0]?.name;

            let priceHtml = "";
            if (actualPriceStr || price) {
                if (actualPriceStr) {
                    priceHtml += `<span class="line-through text-gray-400 text-xl">${actualPriceStr}</span>`;
                }
                if (price) {
                    const formattedPrice = currency === 'INR' ? `₹${price.toFixed(2)}` : `${price.toFixed(2)} ${currency}`;
                    priceHtml += `<span class="text-gold font-bold text-3xl">${formattedPrice}</span>`;
                }
            }

            // Discount Badge calculation
            if (actualPriceStr && price) {
                const actualVal = parseFloat(actualPriceStr.replace(/[^0-9.]/g, ''));
                if (!isNaN(actualVal) && actualVal > price) {
                    const discount = ((actualVal - price) / actualVal) * 100;
                    priceHtml += `<span class="ml-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow-sm align-top">${Math.round(discount)}% OFF</span>`;
                }
            }

            document.getElementById("priceContainer").innerHTML = priceHtml;


            // Description
            let descText = "";
            if (p.description) {
                descText = p.description;
                if (typeof p.description === 'string' && p.description.startsWith('{')) {
                    try {
                        const descObj = JSON.parse(p.description);
                        if (descObj.blocks) {
                            descText = descObj.blocks.map(b => `<p class="mb-2">${b.data.text}</p>`).join('');
                        }
                    } catch (e) { }
                }
            }
            document.getElementById("descriptionContainer").innerHTML = descText;

            // Attributes
            let attrsHtml = "";
            const excludeAttrs = ["Actual Price", "Catalogue"]; // Don't show these in list

            p.attributes.forEach(attr => {
                if (excludeAttrs.includes(attr.attribute.name)) return;

                const val = attr.values[0];
                if (!val) return;

                let valHtml = val.name;

                // Check if FILE type
                if (val.file?.url) {
                    valHtml = `<a href="${val.file.url}" target="_blank" class="text-gold hover:underline flex items-center gap-1">View ${val.name} <ion-icon name="open-outline"></ion-icon></a>`;
                }

                attrsHtml += `
                   <div class="flex justify-between py-2 border-b border-gray-100 last:border-0">
                       <span class="font-medium text-gray-700">${attr.attribute.name}</span>
                       <span class="text-gray-500">${valHtml}</span>
                   </div>
                `;
            });
            document.getElementById("attributesContainer").innerHTML = attrsHtml;

            // Catalogue Link
            const catAttr = p.attributes.find(a => a.attribute.name === "Catalogue");
            if (catAttr && catAttr.values[0]?.file?.url) {
                const url = catAttr.values[0].file.url;
                document.getElementById("catalogueContainer").innerHTML = `
                    <a href="${url}" target="_blank" class="block w-full text-center bg-gray-100 text-gold font-bold py-3 rounded-lg border border-gold hover:bg-gold hover:text-white transition transform active:scale-95">
                        Download Catalogue
                    </a>
                 `;
            }

            // Images
            let imageHtml = "";
            if (p.media && p.media.length > 0) {
                imageHtml = `<div class="owl-carousel product-image-carousel h-96 md:h-[500px]">`;
                p.media.forEach(m => {
                    if (m.type === 'IMAGE') {
                        imageHtml += `<div class="item h-full"><img src="${m.url}" class="w-full h-full object-cover object-center" alt="${p.name}"></div>`;
                    }
                });
                imageHtml += `</div>`;
            } else {
                imageHtml = `<img src="${p.thumbnail?.url || FALLBACK_IMG}" class="w-full h-96 md:h-[500px] object-cover object-center" alt="${p.name}">`;
            }
            document.getElementById("imageContainer").innerHTML = imageHtml;

            // Init Carousel
            setTimeout(() => {
                $('.product-image-carousel').owlCarousel({
                    items: 1,
                    loop: true,
                    dots: true,
                    nav: false,
                    autoplay: true,
                    autoplayHoverPause: true
                });
            }, 100);

            renderCartAction();
            renderVariants(p.variants);
        }

        function renderCartAction() {
            const cart = getCart();
            const inCart = cart.find(i => i.id === currentProduct.id);

            const actionContainer = document.getElementById("cartActionContainer");

            // prepare price for cart obj
            const priceVal = currentProduct.pricing?.priceRange?.start?.gross?.amount || 0;
            const currency = currentProduct.pricing?.priceRange?.start?.gross?.currency || 'INR';

            if (inCart) {
                // Show Quantity Controls
                actionContainer.innerHTML = `
                 <div class="flex items-center justify-between bg-gray-100 rounded-full p-1 border border-gold">
                    <button class="w-12 h-12 flex items-center justify-center text-gray-600 hover:text-red-500 font-bold text-xl transition" onclick="updateQty('${currentProduct.id}', -1)">-</button>
                    <input type="number" readonly class="w-16 text-center bg-transparent font-bold text-xl text-gray-800 focus:outline-none" value="${inCart.quantity}">
                    <button class="w-12 h-12 flex items-center justify-center text-gold hover:text-gold-600 font-bold text-xl transition" onclick="updateQty('${currentProduct.id}', 1)">+</button>
                 </div>
                 <div class="mt-2 text-center text-xs text-gray-500">Item is in your cart</div>
                `;
            } else {
                // Show Add to Cart
                actionContainer.innerHTML = `
                    <button onclick="addToCart()" class="w-full bg-gold text-white font-bold py-4 rounded-full shadow-lg hover:shadow-xl hover:bg-opacity-90 transition transform active:scale-95 text-lg">
                        Add to Inquiry Cart
                    </button>
                `;
            }
        }

        window.addToCart = function () {
            const cart = getCart();
            let priceVal = currentProduct.pricing?.priceRange?.start?.gross?.amount || 0;
            const currency = currentProduct.pricing?.priceRange?.start?.gross?.currency || 'INR';

            // Fallback to Actual Price attribute if price is 0
            if (priceVal === 0 && currentProduct.attributes) {
                const priceAttr = currentProduct.attributes.find(a => a.attribute.name === "Actual Price");
                if (priceAttr && priceAttr.values && priceAttr.values.length > 0) {
                    const parsed = parseFloat(priceAttr.values[0].name.replace(/[^0-9.]/g, ''));
                    if (!isNaN(parsed)) priceVal = parsed;
                }
            }

            const newItem = {
                id: currentProduct.id,
                name: currentProduct.name,
                category: currentProduct.category?.name || '',
                type: currentProduct.productType?.name || '',
                image: currentProduct.thumbnail?.url || FALLBACK_IMG,
                price: priceVal,
                currency: currency,
                quantity: 1
            };
            cart.push(newItem);
            saveCart(cart);
        };

        function renderVariants(variants) {
            const container = document.getElementById("variantContainer");
            container.innerHTML = "";

            if (!variants || variants.length === 0) return;

            variants.forEach(v => {
                const imgUrl = v.media && v.media.length > 0 ? v.media[0].url : (currentProduct.thumbnail?.url || FALLBACK_IMG);
                const priceObj = v.pricing?.price?.gross;
                const price = priceObj ? priceObj.amount : 0;
                const currency = priceObj ? priceObj.currency : 'INR';
                const formattedPrice = currency === 'INR' ? `₹${price.toFixed(2)}` : `${price.toFixed(2)} ${currency}`;

                const div = document.createElement("div");
                div.className = "border rounded-lg p-2 cursor-pointer hover:shadow-md transition bg-white text-center";
                div.innerHTML = `
                    <img src="${imgUrl}" class="w-full h-24 object-cover rounded mb-2" alt="${v.name}">
                    <p class="text-xs font-semibold text-gray-700 truncate">${v.name}</p>
                    <p class="text-xs text-gold font-bold">${formattedPrice}</p>
                `;

                // Optional: click to select logic could go here
                div.onclick = () => {
                    // Logic to switch variant if needed
                    console.log("Variant clicked:", v.id);
                };

                container.appendChild(div);
            });
        }

        window.updateQty = function (id, delta) {
            let cart = getCart();
            const item = cart.find(i => i.id === id);

            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                saveCart(cart);
            }
        };

        // Cart Badge Logic
        function updateCartBadge() {
            const badge = document.getElementById("cartCountBadge");
            const list = JSON.parse(localStorage.getItem("inquiryList") || "[]");
            const count = list.length;
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove("hidden");
            } else {
                badge.classList.add("hidden");
            }
        }
        updateCartBadge();

        init();

    </script>
</body>

</html>