<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gallery Image Products</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    #productGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .product-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    .product-card img { width: 100%; height: 150px; object-fit: cover; }
    .product-card .content { padding: 10px; }
    .product-card h3 { font-size: 1rem; margin: 0 0 5px 0; }
    .product-card p { font-size: 0.9rem; margin: 0; color: #555; }
    .product-card .attributes img { width: 100%; height: 100px; object-fit: cover; margin-top: 5px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Gallery Image Products</h1>
  <div id="productGrid"></div>

  <script>
    const API_URL = "https://api.b-oneinterior.com/graphql/"; // replace with your endpoint
    const CHANNEL = "in";

    async function fetchGraphQL(query, variables = {}) {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query, variables }),
      });
      return res.json();
    }

    async function loadProducts() {
      const productTypeQuery = `
        query {
          productTypes(first: 10, filter: { search: "gallery-image" }) {
            edges { node { id name slug } }
          }
        }
      `;
      const productTypeResult = await fetchGraphQL(productTypeQuery);
      const productTypeNode = productTypeResult.data.productTypes.edges[0]?.node;
      if (!productTypeNode) {
        document.getElementById("productGrid").innerHTML = "<p>No product type found.</p>";
        return;
      }

      const productsQuery = `
        query ($productTypeId: ID!) {
          products(first: 20, channel: "${CHANNEL}", filter: { productTypes: [$productTypeId] }) {
            edges {
              node {
                id
                name
                thumbnail { url }
                pricing { priceRange { start { gross { amount currency } } } }
                attributes{
                  attribute { name slug }
                  values { name file { url contentType } }
                }
              }
            }
          }
        }
      `;

      const productsResult = await fetchGraphQL(productsQuery, { productTypeId: productTypeNode.id });
      const products = productsResult.data.products.edges;
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "";

      if (products.length === 0) {
        grid.innerHTML = "<p>No products found.</p>";
        return;
      }

      products.forEach(p => {
        const beforeFile = p.node.attributes.find(a => a.attribute.slug === "gallery-image-before")?.values[0]?.file?.url || '';
        const afterFile  = p.node.attributes.find(a => a.attribute.slug === "gallery-image-after")?.values[0]?.file?.url || '';

        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <div class="content">
            <h3>${p.node.name}</h3>
            <p>${p.node.pricing?.priceRange?.start?.gross?.amount || '-'} ${p.node.pricing?.priceRange?.start?.gross?.currency || ''}</p>
            <div class="attributes">
              ${beforeFile ? `<img src="${beforeFile}" alt="Gallery Image Before">` : ''}
              ${afterFile  ? `<img src="${afterFile}" alt="Gallery Image After">` : ''}
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    loadProducts();
  </script>
</body>
</html>
