<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Product Details - B-One Interior Premium Collection</title>
    <meta property="og:title" content="Product Details - B-One Interior Premium Collection">
    <meta property="og:description"
        content="View detailed product specifications, pricing, and high-quality images. Add to your cart and bring home elegance with B-One Interior's premium furniture selection.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://b-oneinterior.com/logo.png">
    <meta name="twitter:image" content="https://b-oneinterior.com/logo.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- jQuery + Owl Carousel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7/dist/ionicons/ionicons.esm.js"></script>

    <link rel="stylesheet" href="style.css">

</head>

<body class="bg-white min-h-screen flex flex-col">

    <!-- Header (Same as Shop) -->
    <header class="bg-gray-900 shadow-lg top-0 sticky z-50">
        <nav class="container mx-auto px-4 py-6 flex items-center justify-between">
            <ul class="hidden md:flex space-x-6 text-gray-300">
                <li><a href="https://b-oneinterior.com/" class="hover:text-gold-500 transition">Home</a></li>
                <li><a href="https://b-oneinterior.com/shop" class="hover:text-gold-500 transition">Shop</a></li>
                <li><a href="https://b-oneinterior.com/company" class="hover:text-gold-500 transition">Services</a></li>
                <li><a href="https://b-oneinterior.com/gallery" class="hover:text-gold-500 transition">Gallery</a></li>
                <li><a href="https://b-oneinterior.com/cart" class="hover:text-gold-500 transition">Cart</a></li>
            </ul>
            <button class="md:hidden text-gold-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
        </nav>


    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="fixed inset-0 bg-white/80 z-50 flex items-center justify-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-gold"></div>
        </div>

        <div id="productDetail" class="hidden grid grid-cols-1 md:grid-cols-2 gap-12">

            <!-- Left: Image Section -->
            <div class="w-full">
                <div id="imageContainer" class="rounded-lg overflow-hidden shadow-lg bg-gray-100">
                    <!-- Carousel will be injected here -->
                </div>
            </div>

            <!-- Right: Details Section -->
            <div class="flex flex-col space-y-6">

                <!-- Title & Price -->
                <div>
                    <h1 id="productName" class="text-3xl md:text-4xl font-bold text-gray-900 mb-2"></h1>
                    <div id="priceContainer" class="flex items-baseline gap-4 mt-2"></div>
                </div>

                <!-- Catalogue Button -->
                <div id="catalogueContainer"></div>

                <!-- Short Description / Attributes -->
                <div id="descriptionContainer" class="text-gray-600 leading-relaxed text-sm md:text-base"></div>

                <!-- Attributes List -->
                <div id="attributesContainer" class="space-y-2 pt-4 border-t"></div>

                <!-- Add to Cart / Quantity -->
                <div class="pt-6 mt-auto">
                    <div id="cartActionContainer" class="w-full"></div>
                </div>

            </div>
        </div>

        <div id="errorContainer" class="hidden text-center py-20">
            <h2 class="text-2xl font-bold text-gray-700">Product not found</h2>
            <a href="shop.html" class="text-gold hover:underline mt-4 inline-block">Return to Shop</a>
        </div>

    </main>

    <!-- Bottom Nav (Mobile) -->
    <div class="fixedBottom">
        <a href="https://b-oneinterior.com/" class="logoBx"></a>
        <ul>
            <li>
                <a href="https://b-oneinterior.com/gallery">
                    <ion-icon name="images-outline"></ion-icon>
                    <div>Gallery</div>
                </a>
            </li>


            <li>
                <a href="https://b-oneinterior.com/shop">
                    <ion-icon name="storefront-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
                    <div>Shop</div>

                </a>
            </li>
            <li></li>

            <li>
                <a href="https://b-oneinterior.com/company">
                    <ion-icon name="people-outline" class="text-[#D4AF37] text-2xl"></ion-icon>
                    <div>Company</div>
                </a>
            </li>


            <li>
                <a href="https://b-oneinterior.com/cart">
                    <ion-icon name="cart-outline"></ion-icon>
                    <div>Cart</div>
                    <span id="cartCountBadge" class="absolute -top-2 -right-3 bg-gold text-black text-xs font-bold 
                                w-5 h-5 flex items-center justify-center rounded-full hidden">
                    </span>

                </a>
            </li>
        </ul>
    </div>


    <script>
        const API_URL = "https://api.b-oneinterior.com/graphql/";
        const FALLBACK_IMG = "https://via.placeholder.com/600x600?text=No+Image";

        // Get Product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');

        async function fetchProductDetails(id) {
            const query = `
            query {
                product(id: "${id}", channel: "in") {
                    id
                    name
                    description
                    media {
                        url
                        type
                    }
                    thumbnail {
                        url
                    }
                    pricing {
                        priceRange {
                            start {
                                gross {
                                    amount
                                    currency
                                }
                            }
                        }
                    }
                    attributes {
                        attribute {
                            name
                        }
                        values {
                            name
                            file {
                                url
                            }
                        }
                    }
                    category {
                        name
                    }
                    productType {
                        name
                    }
                }
            }
            `;

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query })
                });
                const json = await res.json();
                return json.data?.product;
            } catch (err) {
                console.error(err);
                return null;
            }
        }

        function getCart() {
            return JSON.parse(localStorage.getItem("inquiryList") || "[]");
        }

        function saveCart(cart) {
            localStorage.setItem("inquiryList", JSON.stringify(cart));
            updateCartBadge();
            renderCartAction(); // Re-render buttons
        }

        let currentProduct = null;

        async function init() {
            if (!productId) {
                showError();
                return;
            }

            currentProduct = await fetchProductDetails(productId);

            if (!currentProduct) {
                showError();
                return;
            }

            renderProduct(currentProduct);
            document.getElementById("loadingSpinner").classList.add("hidden");
            document.getElementById("productDetail").classList.remove("hidden");
        }

        function showError() {
            document.getElementById("loadingSpinner").classList.add("hidden");
            document.getElementById("errorContainer").classList.remove("hidden");
        }

        function renderProduct(p) {
            // Name
            document.getElementById("productName").textContent = p.name;

            // Price
            const currentPriceObj = p.pricing?.priceRange?.start?.gross;
            const price = currentPriceObj ? currentPriceObj.amount : null;
            const currency = currentPriceObj ? currentPriceObj.currency : 'INR';

            // Extract "Actual Price" for discount logic
            const actualPriceAttr = p.attributes.find(a => a.attribute.name === "Actual Price");
            const actualPriceStr = actualPriceAttr?.values[0]?.name;

            let priceHtml = "";
            if (actualPriceStr || price) {
                if (actualPriceStr) {
                    priceHtml += `<span class="line-through text-gray-400 text-xl">${actualPriceStr}</span>`;
                }
                if (price) {
                    const formattedPrice = currency === 'INR' ? `â‚¹${price.toFixed(2)}` : `${price.toFixed(2)} ${currency}`;
                    priceHtml += `<span class="text-gold font-bold text-3xl">${formattedPrice}</span>`;
                }
            }

            // Discount Badge calculation
            if (actualPriceStr && price) {
                const actualVal = parseFloat(actualPriceStr.replace(/[^0-9.]/g, ''));
                if (!isNaN(actualVal) && actualVal > price) {
                    const discount = ((actualVal - price) / actualVal) * 100;
                    priceHtml += `<span class="ml-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded shadow-sm align-top">${Math.round(discount)}% OFF</span>`;
                }
            }

            document.getElementById("priceContainer").innerHTML = priceHtml;


            // Description
            let descText = "";
            if (p.description) {
                descText = p.description;
                if (typeof p.description === 'string' && p.description.startsWith('{')) {
                    try {
                        const descObj = JSON.parse(p.description);
                        if (descObj.blocks) {
                            descText = descObj.blocks.map(b => `<p class="mb-2">${b.data.text}</p>`).join('');
                        }
                    } catch (e) { }
                }
            }
            document.getElementById("descriptionContainer").innerHTML = descText;

            // Attributes
            let attrsHtml = "";
            const excludeAttrs = ["Actual Price", "Catalogue"]; // Don't show these in list

            p.attributes.forEach(attr => {
                if (excludeAttrs.includes(attr.attribute.name)) return;

                const val = attr.values[0];
                if (!val) return;

                let valHtml = val.name;

                // Check if FILE type
                if (val.file?.url) {
                    valHtml = `<a href="${val.file.url}" target="_blank" class="text-gold hover:underline flex items-center gap-1">View ${val.name} <ion-icon name="open-outline"></ion-icon></a>`;
                }

                attrsHtml += `
                   <div class="flex justify-between py-2 border-b border-gray-100 last:border-0">
                       <span class="font-medium text-gray-700">${attr.attribute.name}</span>
                       <span class="text-gray-500">${valHtml}</span>
                   </div>
                `;
            });
            document.getElementById("attributesContainer").innerHTML = attrsHtml;

            // Catalogue Link
            const catAttr = p.attributes.find(a => a.attribute.name === "Catalogue");
            if (catAttr && catAttr.values[0]?.file?.url) {
                const url = catAttr.values[0].file.url;
                document.getElementById("catalogueContainer").innerHTML = `
                    <a href="${url}" target="_blank" class="block w-full text-center bg-gray-100 text-gold font-bold py-3 rounded-lg border border-gold hover:bg-gold hover:text-white transition transform active:scale-95">
                        Download Catalogue
                    </a>
                 `;
            }

            // Images
            let imageHtml = "";
            if (p.media && p.media.length > 0) {
                imageHtml = `<div class="owl-carousel product-image-carousel h-96 md:h-[500px]">`;
                p.media.forEach(m => {
                    if (m.type === 'IMAGE') {
                        imageHtml += `<div class="item h-full"><img src="${m.url}" class="w-full h-full object-cover object-center" alt="${p.name}"></div>`;
                    }
                });
                imageHtml += `</div>`;
            } else {
                imageHtml = `<img src="${p.thumbnail?.url || FALLBACK_IMG}" class="w-full h-96 md:h-[500px] object-cover object-center" alt="${p.name}">`;
            }
            document.getElementById("imageContainer").innerHTML = imageHtml;

            // Init Carousel
            setTimeout(() => {
                $('.product-image-carousel').owlCarousel({
                    items: 1,
                    loop: true,
                    dots: true,
                    nav: false,
                    autoplay: true,
                    autoplayHoverPause: true
                });
            }, 100);

            renderCartAction();
        }

        function renderCartAction() {
            const cart = getCart();
            const inCart = cart.find(i => i.id === currentProduct.id);

            const actionContainer = document.getElementById("cartActionContainer");

            // prepare price for cart obj
            const priceVal = currentProduct.pricing?.priceRange?.start?.gross?.amount || 0;
            const currency = currentProduct.pricing?.priceRange?.start?.gross?.currency || 'INR';

            if (inCart) {
                // Show Quantity Controls
                actionContainer.innerHTML = `
                 <div class="flex items-center justify-between bg-gray-100 rounded-full p-1 border border-gold">
                    <button class="w-12 h-12 flex items-center justify-center text-gray-600 hover:text-red-500 font-bold text-xl transition" onclick="updateQty('${currentProduct.id}', -1)">-</button>
                    <input type="number" readonly class="w-16 text-center bg-transparent font-bold text-xl text-gray-800 focus:outline-none" value="${inCart.quantity}">
                    <button class="w-12 h-12 flex items-center justify-center text-gold hover:text-gold-600 font-bold text-xl transition" onclick="updateQty('${currentProduct.id}', 1)">+</button>
                 </div>
                 <div class="mt-2 text-center text-xs text-gray-500">Item is in your cart</div>
                `;
            } else {
                // Show Add to Cart
                actionContainer.innerHTML = `
                    <button onclick="addToCart()" class="w-full bg-gold text-white font-bold py-4 rounded-full shadow-lg hover:shadow-xl hover:bg-opacity-90 transition transform active:scale-95 text-lg">
                        Add to Inquiry Cart
                    </button>
                `;
            }
        }

        window.addToCart = function () {
            const cart = getCart();
            let priceVal = currentProduct.pricing?.priceRange?.start?.gross?.amount || 0;
            const currency = currentProduct.pricing?.priceRange?.start?.gross?.currency || 'INR';

            // Fallback to Actual Price attribute if price is 0
            if (priceVal === 0 && currentProduct.attributes) {
                const priceAttr = currentProduct.attributes.find(a => a.attribute.name === "Actual Price");
                if (priceAttr && priceAttr.values && priceAttr.values.length > 0) {
                    const parsed = parseFloat(priceAttr.values[0].name.replace(/[^0-9.]/g, ''));
                    if (!isNaN(parsed)) priceVal = parsed;
                }
            }

            const newItem = {
                id: currentProduct.id,
                name: currentProduct.name,
                category: currentProduct.category?.name || '',
                type: currentProduct.productType?.name || '',
                image: currentProduct.thumbnail?.url || FALLBACK_IMG,
                price: priceVal,
                currency: currency,
                quantity: 1
            };

            cart.push(newItem);
            saveCart(cart);
        };

        window.updateQty = function (id, delta) {
            let cart = getCart();
            const item = cart.find(i => i.id === id);

            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                saveCart(cart);
            }
        };

        // Cart Badge Logic
        function updateCartBadge() {
            const badge = document.getElementById("cartCountBadge");
            const list = JSON.parse(localStorage.getItem("inquiryList") || "[]");
            const count = list.length;
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove("hidden");
            } else {
                badge.classList.add("hidden");
            }
        }
        updateCartBadge();

        init();

    </script>
</body>

</html>